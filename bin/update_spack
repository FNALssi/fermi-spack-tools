#!/bin/sh

set +e
pkglist=$1
export SPACK_ROOT=$2
export PATH=$SPACK_ROOT/bin:$PATH

spack_repo=https://cdcvs.fnal.gov/projects/spack-infrastructure-spack
spack_release=rollout
binary_cache=https://spack-cache-1.fnal.gov/binaries/

if [ ! -d $SPACK_ROOT ]
then
    make_spack $SPACK_ROOT
fi

export PATH=$SPACK_ROOT/bin:$PATH
comm -2 -3 ${pkglist} ${pkglist}.bak |
  while read spec
  do
     spack buildcache install -u -a "$spec"
  done

cp ${pkglist} ${pkglist}.bak
