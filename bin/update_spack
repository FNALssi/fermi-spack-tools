#!/bin/sh

set +e
pkglist=$1
export SPACK_ROOT=$2
export PATH=$SPACK_ROOT/bin:$PATH

if [ ! -d $SPACK_ROOT ]
then
    make_spack -u $SPACK_ROOT/../../..
    # save the rest for later...
    exit
fi

export PATH=$SPACK_ROOT/bin:$PATH
comm -2 -3 ${pkglist} ${pkglist}.bak |
  while read what spec
  do
     case $what in
     i) spack buildcache install -a "$spec" ;;
     t) cd $SPACK_ROOT && tar xzf $spec;;
     r) spack uninstall "$spec";;
     esac
  done

cp ${pkglist} ${pkglist}.bak
