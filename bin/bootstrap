#!/bin/bash

# pull down spack-infrastructure
# use it to install
dest=${1:-$PWD}
ver=${2:-v2_18_00_01}
spackver=${3:-v0.18.0.fermi}

mkdir -p $dest/spack-infrastructure/$ver
cd $dest

git clone -b $ver https://github.com/FNALssi/spack-infrastructure.git spack-infrastructure/$ver/NULL/

PATH=$dest/spack-infrastructure/$ver/NULL/bin:$PATH

make_spack --spack_release $spackver --minimal -u $dest

source $dest/setup-env.sh

spack compiler find --scope=site

cd $dest/spack-infrastructure/$ver/NULL && bin/declare_simple spack-infrastructure $ver

